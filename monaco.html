<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        #editor {
            width: calc(100% - 20px);
            height: calc(100vh - 50px);
            border: 1px solid #ccc;
        }
    </style>

<body>
<div id="head">
    <button onclick="format()">format</button>
    <button onclick="zip()">zip</button>
</div>
<div id="editor" ></div>
<script src='https://cdn.jsdelivr.net/npm/monaco-editor@0.22.3/min/vs/loader.js'></script>
<script>
        require.config({
            paths: {
                vs: 'https://cdn.jsdelivr.net/npm/monaco-editor@0.22.3/min/vs'
            },
            'vs/nls': { availableLanguages: { '*': 'zh-cn' } }
        });

        //载入Monaco
        // https://code.visualstudio.com/docs/getstarted/keybindings#_keyboard-shortcuts-reference
        var editor = null;
        require(['vs/editor/editor.main'], function () {
            //得到支持的语言
            var modesIds = monaco.languages.getLanguages().map(function (lang) { return lang.id }).sort();

            //创建编辑器
            editor = monaco.editor.create(document.getElementById("editor"), {
                //内容
                value: 'console.log("Hello world!");',
                lineNumbers: 'on',
                //语言
                language: 'json',
                //自适应调整
                automaticLayout: true,
                //主题，三款：vs、vs-dark、hc-black
                theme: 'vs',
                //代码略缩图
                minimap: {
                    enabled: false
                }
            });

            loadByQueryString()
        });

        function loadByQueryString() {
            var encoded = window.location.hash.substring("#src=".length);
            try {
                sample = decodeURIComponent(encoded);
                editor.getModel().setValue(sample);

                setTimeout(function () {
                    editor.getAction('editor.action.formatDocument')
                          .run()
                          .then(() => editor.updateOptions({readOnly: false}))

                }, 1000);

            }
            catch (e) {
                console.log("unable to parse #src= uri component");
                // intentionally fall through to alternatives if decode fails
            }
        }

       function format() {
          console.log("start format")
          this.editor.trigger('anyString', 'editor.action.formatDocument')
       }

       function zip() {
          console.log("start to zip")
          if (this.editor.getValue() == undefined || this.editor.getValue().length==0) {
             console.log("empty")
             return
          }
          console.log(this.editor.getValue())
          const lines = this.editor.getValue().split("\n");
          const trimmedLines = lines.map((line) => line.trim());
          const filteredLines = trimmedLines.filter((line) => line !== "");
          const finalJson = filteredLines.join("");
          this.editor.getModel().setValue(finalJson);
       }
    </script>
</body>

</html>